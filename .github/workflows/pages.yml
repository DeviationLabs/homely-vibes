name: Deploy README to GitHub Pages

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v5
        
      - name: Install markdown dependency
        run: pip install markdown
        
      - name: Create simple HTML from README
        run: |
          mkdir -p _site
          echo '<!DOCTYPE html>
          <html>
          <head>
              <meta charset="utf-8">
              <meta name="viewport" content="width=device-width, initial-scale=1">
              <title>Homely Vibes - IoT Home Automation</title>
              <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-light.min.css">
              <style>
                  .markdown-body { box-sizing: border-box; min-width: 200px; max-width: 980px; margin: 0 auto; padding: 45px; }
                  .btn-group { margin: 20px 0; }
                  .btn-custom { 
                      display: inline-block; 
                      padding: 10px 20px; 
                      background-color: #0366d6; 
                      color: white; 
                      text-decoration: none; 
                      border-radius: 6px; 
                      font-weight: 600;
                  }
                  .btn-custom:hover { background-color: #0256cc; color: white; text-decoration: none; }
              </style>
          </head>
          <body class="markdown-body">
          ' > _site/index.html
          
          # Convert README.md to HTML and append
          python3 -c "
          import markdown
          with open('README.md', 'r') as f:
              content = f.read()
          html = markdown.markdown(content, extensions=['tables', 'fenced_code'])
          print(html)
          " >> _site/index.html
          
          echo '</body></html>' >> _site/index.html
          
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4